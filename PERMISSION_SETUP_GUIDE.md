# 权限设置指南

## 🚨 重要提醒

本应用需要以下权限才能正常运行，**请务必按照本指南完成所有权限设置**：

1. **无障碍服务权限** - 用于自动化操作
2. **悬浮窗权限** - 防止应用被后台杀死
3. **截屏权限** - 用于截取屏幕
4. **后台服务权限** - 确保脚本在后台运行
5. **网络权限** - 发送API请求
6. **存储权限** - 保存截图文件

---

## 📱 详细设置步骤

### 1. 无障碍服务权限

**作用**：允许应用执行自动化操作（点击、滑动、截屏等）

**设置步骤**：
1. 打开应用，点击"启动脚本"按钮
2. 系统会弹出提示："需要开启无障碍服务"
3. 点击"确定"跳转到无障碍设置页面
4. 在设置中找到"得物自动化脚本"
5. 点击进入，开启服务开关
6. 确认服务状态显示为"已开启"

**路径**：设置 → 更多设置 → 无障碍 → 得物自动化脚本

**验证方法**：服务开启后，应用界面会显示"无障碍服务已启用"

---

### 2. 悬浮窗权限（重要！）

**作用**：防止应用在后台被系统杀死，确保脚本持续运行

**设置步骤**：
1. 首次启动脚本时，系统会提示授予悬浮窗权限
2. 点击"允许显示在其他应用上层"
3. 如果错过了首次提示，可以手动设置：
   - 设置 → 应用设置 → 权限管理 → 悬浮窗
   - 找到"得物自动化脚本"
   - 开启悬浮窗权限

**路径**：设置 → 应用设置 → 权限管理 → 悬浮窗 → 得物自动化脚本

**验证方法**：启动脚本后，屏幕右上角会出现悬浮窗显示脚本状态

---

### 3. 截屏权限

**作用**：允许应用截取屏幕内容并发送到API

**设置步骤**：
1. 点击"启动脚本"按钮
2. 系统会弹出截屏权限请求对话框
3. 点击"立即开始"授予权限
4. 如果权限被拒绝，可以重新授权：
   - 设置 → 应用设置 → 应用管理 → 得物自动化脚本
   - 权限管理 → 找到截屏相关权限并开启

**验证方法**：启动脚本后，应用会成功截取屏幕截图

---

### 4. 后台服务权限

**作用**：确保应用在后台持续运行，不被系统清理

**设置步骤**：
1. 设置 → 应用设置 → 应用管理
2. 找到"得物自动化脚本"
3. 点击"省电策略"
4. 选择"无限制"
5. 开启"自启动"权限
6. 确保"后台运行权限"已开启

**路径**：设置 → 应用设置 → 应用管理 → 得物自动化脚本

**验证方法**：应用在后台运行时不会被系统杀死

---

### 5. 网络权限

**作用**：允许应用发送API请求

**设置步骤**：
1. 设置 → 应用设置 → 权限管理 → 网络
2. 找到"得物自动化脚本"
3. 确保网络权限已开启
4. 确保设备已连接网络（WiFi或移动数据）

**验证方法**：应用能够成功发送API请求

---

### 6. 存储权限

**作用**：允许应用保存截图文件

**设置步骤**：
1. 设置 → 应用设置 → 权限管理 → 存储
2. 找到"得物自动化脚本"
3. 开启存储权限

**验证方法**：应用能够成功保存截图文件

---

## 🔧 MIUI用户特殊设置

### 小米手机（MIUI）额外设置

MIUI系统对后台应用管理较为严格，需要额外设置：

#### 1. 应用锁定（推荐）
1. 打开"最近任务"（多任务界面）
2. 找到"得物自动化脚本"应用卡片
3. 下拉卡片，点击🔒图标锁定应用
4. 锁定后应用不会被系统清理

#### 2. 关闭省电模式
1. 设置 → 电池与性能
2. 关闭"省电模式"
3. 将应用设置为"无限制"

#### 3. 关闭MIUI优化
1. 设置 → 更多设置 → 开发者选项
2. 找到"MIUI优化"选项
3. 关闭MIUI优化
4. 重启手机

#### 4. 开发者选项设置
1. 设置 → 我的设备 → 全部参数
2. 连续点击"MIUI版本"7次开启开发者选项
3. 设置 → 更多设置 → 开发者选项
4. 开启以下选项：
   - USB调试
   - USB安装
   - USB调试（安全设置）
   - 保持唤醒状态

---

## ✅ 权限检查清单

在启动脚本前，请逐项检查以下权限：

### 基础权限
- [ ] **无障碍服务**：设置 → 更多设置 → 无障碍 → 得物自动化脚本（已开启）
- [ ] **悬浮窗权限**：设置 → 应用设置 → 权限管理 → 悬浮窗 → 得物自动化脚本（已开启）
- [ ] **截屏权限**：启动脚本时会自动请求，点击"立即开始"
- [ ] **后台权限**：设置 → 应用设置 → 应用管理 → 得物自动化脚本 → 省电策略 → 无限制
- [ ] **自启动权限**：设置 → 应用设置 → 应用管理 → 得物自动化脚本 → 自启动（已开启）
- [ ] **网络权限**：确保设备已连接网络
- [ ] **存储权限**：用于保存截图文件

### MIUI用户额外检查
- [ ] **应用锁定**：最近任务 → 得物自动化脚本 → 下拉锁定
- [ ] **关闭省电模式**：设置 → 电池与性能 → 关闭省电模式
- [ ] **关闭MIUI优化**：设置 → 更多设置 → 开发者选项 → 关闭MIUI优化

---

## 🚨 常见问题解决

### 问题1：脚本启动后立即停止
**原因**：权限设置不完整
**解决方案**：
1. 检查无障碍服务是否已开启
2. 检查悬浮窗权限是否已授予
3. 检查后台权限是否设置为"无限制"

### 问题2：脚本运行一段时间后停止
**原因**：MIUI后台管理限制
**解决方案**：
1. 锁定应用（最近任务 → 下拉锁定）
2. 关闭省电模式
3. 关闭MIUI优化
4. 设置省电策略为"无限制"

### 问题3：无法截屏
**原因**：截屏权限未授予
**解决方案**：
1. 重新启动脚本，点击"立即开始"
2. 手动设置：设置 → 应用设置 → 权限管理 → 截屏权限

### 问题4：API请求失败
**原因**：网络权限或网络连接问题
**解决方案**：
1. 检查网络连接
2. 检查网络权限是否已开启
3. 确认API地址是否正确

---

## 📞 技术支持

如果按照本指南设置后仍有问题，请提供以下信息：

- 手机型号和系统版本
- MIUI版本（如果是小米手机）
- 具体错误信息
- 权限设置截图

---

## 📝 注意事项

1. **权限设置顺序**：建议按照本指南的顺序设置权限
2. **重启应用**：设置完权限后，建议重启应用
3. **定期检查**：系统更新后可能需要重新设置部分权限
4. **安全提醒**：无障碍服务具有较高权限，请谨慎使用
5. **备份设置**：建议截图保存权限设置，便于后续参考

---

**最后提醒**：完成所有权限设置后，应用应该能够正常运行。如果仍有问题，请参考故障排除部分或联系技术支持。
